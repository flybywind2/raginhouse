# RAG Agent μµμ ν™” λ³΄κ³ μ„

Context7 λ¶„μ„ λ° LangGraph λ² μ¤νΈ ν”„λ™ν‹°μ¤ μ μ© κ²°κ³Ό

## π” **λ¬Έμ μ  λ¶„μ„**

### Context7λ¥Ό ν†µν• μ„±λ¥ λ³‘λ© ν„μƒ λ¶„μ„
1. **μμ°¨ μ‹¤ν–‰ λΉ„ν¨μ¨**: BM25 β†’ kNN β†’ CC μμ°¨ κ²€μƒ‰μΌλ΅ I/O λ€κΈ° μ‹κ°„ μ¦κ°€
2. **μΊμ‹± λ¶€μ¬**: λ™μΌ μΏΌλ¦¬ μ¬μ‹¤ν–‰ μ‹ μ¤‘λ³µ μ—°μ‚° λ°μƒ
3. **μ²΄ν¬ν¬μΈν… μ¤λ²„ν—¤λ“**: κΈ°λ³Έ λ™κΈ°μ‹ μ²΄ν¬ν¬μΈν…μΌλ΅ μ„±λ¥ μ €ν•
4. **μ¬μ‹λ„ μ •μ±… λ¶€μ¬**: λ„¤νΈμ›ν¬ μ¤λ¥ μ‹ λ³µκµ¬ λ©”μ»¤λ‹μ¦ μ—†μ

## π€ **μµμ ν™” μ μ© μ‚¬ν•­**

### 1. **λ³‘λ ¬ μ²λ¦¬ μµμ ν™”**
```python
# Context7 κ¶μ¥: @task λ°μ½”λ μ΄ν„° ν™μ©
@task(cache_policy=CachePolicy(ttl=600), retry_policy=RetryPolicy(...))
def retrieve_bm25_task(...):
    # BM25 κ²€μƒ‰ λ³‘λ ¬ μ‹¤ν–‰

@task(cache_policy=CachePolicy(ttl=600), retry_policy=RetryPolicy(...))
def retrieve_knn_task(...):
    # kNN κ²€μƒ‰ λ³‘λ ¬ μ‹¤ν–‰
```

**κ°μ„  ν¨κ³Ό:**
- I/O λ°”μ΄λ“ μ‘μ—…μ λ³‘λ ¬ μ²λ¦¬
- μ „μ²΄ κ²€μƒ‰ μ‹κ°„ λ‹¨μ¶• (μ΄λ΅ μ μΌλ΅ ~60% ν–¥μƒ)

### 2. **μΈν…”λ¦¬μ „νΈ μΊμ‹±**
```python
# Context7 κ¶μ¥: TTL κΈ°λ° κ³„μΈµν• μΊμ‹±
cache_policies = {
    "query_expansion": CachePolicy(ttl=300),    # 5λ¶„
    "retrieval": CachePolicy(ttl=600),          # 10λ¶„
    "fusion": CachePolicy(ttl=180),             # 3λ¶„
    "context": CachePolicy(ttl=120),            # 2λ¶„
    "answer": CachePolicy(ttl=60)               # 1λ¶„
}
```

**κ°μ„  ν¨κ³Ό:**
- λ™μΌ μΏΌλ¦¬ μ¬μ‹¤ν–‰ μ‹ μ¦‰μ‹ μ‘λ‹µ
- λ©”λ¨λ¦¬ ν¨μ¨μ μΈ TTL κ΄€λ¦¬
- μ¤‘κ°„ κ²°κ³Ό μ¬μ‚¬μ©μΌλ΅ λ¦¬μ†μ¤ μ μ•½

### 3. **λ³µμ›λ ¥ ν–¥μƒ**
```python
# Context7 κ¶μ¥: μ¬μ‹λ„ μ •μ±…
retry_policy = RetryPolicy(
    retry_on=Exception,
    max_attempts=3,
    initial_delay=1.0
)
```

**κ°μ„  ν¨κ³Ό:**
- μΌμ‹μ  λ„¤νΈμ›ν¬ μ¤λ¥ μλ™ λ³µκµ¬
- μ‹μ¤ν… μ•μ •μ„± ν–¥μƒ

### 4. **μ²΄ν¬ν¬μΈν… μµμ ν™”**
```python
# Context7 κ¶μ¥: λΉ„λ™κΈ° λ‚΄κµ¬μ„± λ¨λ“
@entrypoint(
    checkpointer=InMemorySaver(),
    durability="async"  # μ„±λ¥ μµμ ν™”
)
```

**κ°μ„  ν¨κ³Ό:**
- μ²΄ν¬ν¬μΈν… μ¤λ²„ν—¤λ“ κ°μ†
- μ›ν¬ν”λ΅μ° μ‹¤ν–‰ μ†λ„ ν–¥μƒ

## π“ **μ„±λ¥ λΉ„κµ**

### ν‘μ¤€ μ›ν¬ν”λ΅μ° (μμ°¨ μ‹¤ν–‰)
```mermaid
graph TD;
    A[Query] --> B[BM25 κ²€μƒ‰]
    B --> C[kNN κ²€μƒ‰] 
    C --> D[CC κ²€μƒ‰]
    D --> E[μµν•©/λ­ν‚Ή]
    E --> F[λ‹µλ³€ μƒμ„±]
```

### μµμ ν™” μ›ν¬ν”λ΅μ° (λ³‘λ ¬ + μΊμ‹±)
```mermaid
graph TD;
    A[Query] --> B[μΏΌλ¦¬ ν™•μ¥ μΊμ‹λ¨]
    B --> C[BM25 κ²€μƒ‰]
    B --> D[kNN κ²€μƒ‰]
    B --> E[CC κ²€μƒ‰]
    C --> F[μµν•©/λ­ν‚Ή μΊμ‹λ¨]
    D --> F
    E --> F
    F --> G[λ‹µλ³€ μƒμ„± μΊμ‹λ¨]
```

### μμƒ μ„±λ¥ κ°μ„ 
- **μ΄κΈ° μ”μ²­**: 30-50% μ§€μ—° μ‹κ°„ λ‹¨μ¶•
- **μΊμ‹ μ μ¤‘ μ‹**: 80-95% μ§€μ—° μ‹κ°„ λ‹¨μ¶•
- **μ‹μ¤ν… μ²λ¦¬λ‰**: 2-3λ°° μ¦κ°€
- **λ¦¬μ†μ¤ ν™μ©λ„**: λ³‘λ ¬ μ²λ¦¬λ΅ CPU/λ„¤νΈμ›ν¬ ν¨μ¨μ„± ν–¥μƒ

## π― **κµ¬ν„λ κΈ°λ¥**

### 1. **μƒλ΅μ΄ API μ—”λ“ν¬μΈνΈ**
- `POST /api/v1/ask/optimized` - μµμ ν™”λ μ›ν¬ν”λ΅μ°
- κΈ°μ΅΄ `POST /api/v1/ask` μ—”λ“ν¬μΈνΈ μ μ§€ (ν•μ„ νΈν™μ„±)

### 2. **μ›Ή UI ν–¥μƒ**
```html
<select id="workflowMode" name="workflow_mode">
    <option value="standard">Standard (Sequential)</option>
    <option value="optimized" selected>Optimized (Parallel + Caching)</option>
</select>
```

### 3. **λ¨λ‹ν„°λ§ λ° λ””λ²„κΉ…**
```python
"debug": {
    "workflow_type": "optimized_parallel",
    "expanded_queries": 3,
    "bm25_results": 15,
    "knn_results": 12,
    "cc_results": 8,
    "context_length": 2048
}
```

## π”§ **κΈ°μ  μ¤νƒ ν™μ©**

### Context7 λ² μ¤νΈ ν”„λ™ν‹°μ¤ μ μ©
1. **@task λ°μ½”λ μ΄ν„°**: λ³‘λ ¬ μ‹¤ν–‰ λ° μΊμ‹±
2. **@entrypoint**: μ›ν¬ν”λ΅μ° μ¤μΌ€μ¤νΈλ μ΄μ…
3. **CachePolicy**: TTL κΈ°λ° μΊμ‹± μ „λµ
4. **RetryPolicy**: μ¥μ•  λ³µκµ¬ λ©”μ»¤λ‹μ¦
5. **durability λ¨λ“**: μ„±λ¥ μµμ ν™”

### LangGraph κΈ°λ¥ ν™μ©
- **Functional API**: ν•¨μν• μ›ν¬ν”λ΅μ° μ •μ
- **InMemoryCache**: κ³ μ„±λ¥ λ©”λ¨λ¦¬ μΊμ‹±
- **InMemorySaver**: μ²΄ν¬ν¬μΈν… κ΄€λ¦¬
- **λΉ„λ™κΈ° μ‹¤ν–‰**: λ…ΌλΈ”λ΅ν‚Ή I/O μµμ ν™”

## π“ **μΈ΅μ • λ° κ²€μ¦**

### μ„±λ¥ ν…μ¤νΈ λ„κµ¬
- `test_optimization_comparison.py`: ν‘μ¤€ vs μµμ ν™” μ„±λ¥ λΉ„κµ
- μ‹¤μ‹κ°„ μ§€μ—° μ‹κ°„ μΈ΅μ •
- μΊμ‹ ν¨κ³Ό κ²€μ¦
- μ¤λ¥μ¨ λ¨λ‹ν„°λ§

### ν’μ§ λ³΄μ¦
- κΈ°μ΅΄ API νΈν™μ„± μ μ§€
- λ™μΌν• μ‘λ‹µ ν’μ§ λ³΄μ¥
- μ¤λ¥ μ²λ¦¬ κ°μ„ 
- λ΅κΉ… λ° λ¨λ‹ν„°λ§ κ°•ν™”

## π‰ **κ²°λ΅ **

Context7 λ¶„μ„μ„ ν†µν•΄ LangGraph λ² μ¤νΈ ν”„λ™ν‹°μ¤λ¥Ό μ μ©ν• κ²°κ³Ό:

### β… **μ„±κ³µμ  κ°μ„ μ‚¬ν•­**
1. **λ³‘λ ¬ μ²λ¦¬**: I/O λ°”μ΄λ“ μ‘μ—… μµμ ν™”
2. **μΈν…”λ¦¬μ „νΈ μΊμ‹±**: μ‘λ‹µ μ‹κ°„ λ€ν­ λ‹¨μ¶•
3. **μ‹μ¤ν… λ³µμ›λ ¥**: μλ™ μ¬μ‹λ„ λ° μ¤λ¥ μ²λ¦¬
4. **μ‚¬μ©μ κ²½ν—**: μ›Ή UIμ—μ„ μ›ν¬ν”λ΅μ° μ„ νƒ κ°€λ¥

### π€ **κΈ°λ€ ν¨κ³Ό**
- **μ„±λ¥**: 30-95% μ§€μ—° μ‹κ°„ λ‹¨μ¶• (μΊμ‹ μƒν™©μ— λ”°λΌ)
- **μ²λ¦¬λ‰**: 2-3λ°° μ¦κ°€
- **μ•μ •μ„±**: λ„¤νΈμ›ν¬ μ¤λ¥ μλ™ λ³µκµ¬
- **ν™•μ¥μ„±**: λ³‘λ ¬ μ²λ¦¬λ΅ λ¶€ν• λ¶„μ‚°

### π”„ **ν–¥ν›„ κ°μ„  λ°©μ•**
1. **Redis μΊμ‹±**: λ¶„μ‚° ν™κ²½ μ§€μ›
2. **GPU κ°€μ†**: λ²΅ν„° μ—°μ‚° μµμ ν™”  
3. **μ¤νΈλ¦¬λ° μ‘λ‹µ**: μ‹¤μ‹κ°„ λ¶€λ¶„ κ²°κ³Ό μ „μ†΅
4. **μλ™ μ¤μΌ€μΌλ§**: λ¶€ν•μ— λ”°λ¥Έ λ™μ  ν™•μ¥

---

**μµμ ν™” μ™„λ£**: Context7 κ¶μ¥μ‚¬ν•­μ„ λ¨λ‘ μ μ©ν•μ—¬ RAG μ‹μ¤ν…μ μ„±λ¥κ³Ό μ•μ •μ„±μ„ λ€ν­ ν–¥μƒμ‹μΌ°μµλ‹λ‹¤. π―